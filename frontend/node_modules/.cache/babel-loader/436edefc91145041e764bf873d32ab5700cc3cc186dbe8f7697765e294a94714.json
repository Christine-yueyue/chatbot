{"ast":null,"code":"import{useEnsureRegeneratorRuntime}from\"../app/hook/useEnsureRegeneratorRuntime\";import{useSearchParams}from\"react-router-dom\";import{useEffect,useRef,useState}from\"react\";import Bubble from\"./chat/message\";import SendForm from\"./chat/chat-form\";import LZString from\"lz-string\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Chat(){const[searchParams]=useSearchParams();const share=searchParams.get(\"share\");const lzstring=LZString;// ✅ State to store messages and input\nconst[messages,setMessages]=useState(share&&lzstring?JSON.parse(lzstring.decompressFromEncodedURIComponent(share)):[{id:\"initialai\",role:\"assistant\",content:\"Welcome to the Patient Feedback Chat. Your experience matters to us! Please share your feedback about your treatment.\"}]);const[input,setInput]=useState(\"\");const[isLoading,setIsLoading]=useState(false);useEnsureRegeneratorRuntime();const messagesEndRef=useRef(null);useEffect(()=>{if(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:\"smooth\"});}},[messages]);// Function to send message to FastAPI\nasync function handleSubmit(event){event.preventDefault();if(!input.trim())return;const userMessage={id:Date.now().toString(),role:\"user\",content:input};setMessages(prev=>[...prev,userMessage]);setInput(\"\");setIsLoading(true);try{const response=await fetch(\"https://chatbot-2024-90539106da8b.herokuapp.com/chatbot/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({message:input})});const data=await response.json();const botMessage={id:Date.now().toString(),role:\"assistant\",content:data.response};setMessages(prev=>[...prev,botMessage]);// Add AI response to chat\n}catch(error){console.error(\"Error fetching chatbot response:\",error);}finally{setIsLoading(false);}}return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Chatbot\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Patient Feedback\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.map(message=>/*#__PURE__*/_jsx(Bubble,{message:message},message.id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-input-area\",children:/*#__PURE__*/_jsx(SendForm,{input:input,handleSubmit:handleSubmit,isLoading:isLoading,handleInputChange:e=>setInput(e.target.value)})})]});}","map":{"version":3,"names":["useEnsureRegeneratorRuntime","useSearchParams","useEffect","useRef","useState","Bubble","SendForm","LZString","jsx","_jsx","jsxs","_jsxs","Chat","searchParams","share","get","lzstring","messages","setMessages","JSON","parse","decompressFromEncodedURIComponent","id","role","content","input","setInput","isLoading","setIsLoading","messagesEndRef","current","scrollIntoView","behavior","handleSubmit","event","preventDefault","trim","userMessage","Date","now","toString","prev","response","fetch","method","headers","body","stringify","message","data","json","botMessage","error","console","className","children","map","ref","handleInputChange","e","target","value"],"sources":["/Users/christine/Downloads/feedback-management-main/frontend/src/components/chat.js"],"sourcesContent":["import { useEnsureRegeneratorRuntime } from \"../app/hook/useEnsureRegeneratorRuntime\";\nimport { useSearchParams } from \"react-router-dom\";\nimport { useEffect, useRef, useState } from \"react\";\nimport Bubble from \"./chat/message\";\nimport SendForm from \"./chat/chat-form\";\nimport LZString from \"lz-string\";\n\nexport default function Chat() {\n  const [searchParams] = useSearchParams();\n  const share = searchParams.get(\"share\");\n  const lzstring = LZString;\n\n  // ✅ State to store messages and input\n  const [messages, setMessages] = useState(\n    share && lzstring\n      ? JSON.parse(lzstring.decompressFromEncodedURIComponent(share))\n      : [\n          {\n            id: \"initialai\",\n            role: \"assistant\",\n            content:\n              \"Welcome to the Patient Feedback Chat. Your experience matters to us! Please share your feedback about your treatment.\",\n          },\n        ]\n  );\n\n  const [input, setInput] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEnsureRegeneratorRuntime();\n\n  const messagesEndRef = useRef(null);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }, [messages]);\n\n  // Function to send message to FastAPI\n  async function handleSubmit(event) {\n    event.preventDefault();\n    if (!input.trim()) return;\n\n    const userMessage = { id: Date.now().toString(), role: \"user\", content: input };\n    setMessages((prev) => [...prev, userMessage]); \n    setInput(\"\"); \n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\"https://chatbot-2024-90539106da8b.herokuapp.com/chatbot/\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message: input }),\n      });\n\n      const data = await response.json();\n      const botMessage = { id: Date.now().toString(), role: \"assistant\", content: data.response };\n\n      setMessages((prev) => [...prev, botMessage]); // Add AI response to chat\n    } catch (error) {\n      console.error(\"Error fetching chatbot response:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"chat-wrapper\">\n      <div className=\"chat-header\">\n        <h1>Chatbot</h1>\n        <p>Patient Feedback</p>\n      </div>\n      \n      <div className=\"chat-messages\">\n        {messages.map((message) => (\n          <Bubble key={message.id} message={message} />\n        ))}\n        <div ref={messagesEndRef} />\n      </div>\n\n      <div className=\"chat-input-area\">\n        <SendForm\n          input={input}\n          handleSubmit={handleSubmit}\n          isLoading={isLoading}\n          handleInputChange={(e) => setInput(e.target.value)}\n        />\n      </div>\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}